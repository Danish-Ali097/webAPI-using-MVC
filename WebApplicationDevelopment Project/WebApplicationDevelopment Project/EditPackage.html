<!DOCCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Packages | Travelex&reg;</title>
    <!-- Bootstrap core CSS -->
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link href="fontawesome-free-5.8.1-web/css/all.min.css" rel="stylesheet" />
    <script src="Scripts/jquery-3.3.1.min.js"></script>
    <!-- Custom styles for this template -->
    <link href="bootstrap/Style.css?v=1.1" rel="stylesheet" />
</head>
<body>
    <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
        <a class="navbar-brand" href="#">Admin Panel</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarsExampleDefault">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item">
                    <a class="nav-link" href="Dashboard.html">Dashboard <span class="sr-only"></span></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="EditUser.html">Users</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" href="#">Packages</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="EditServices.html">Services</a>
                </li>
            </ul>
            <nav class="navbar navbar-light navbar-right custom-nav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="Login.html">Login <span class="sr-only"></span></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Signup <span class="sr-only"></span></a>
                    </li>
                </ul>
            </nav>
        </div>
    </nav>
    <div class="container-fluid" style="margin-top:80px;">
        <div class="row">
            <div class="col-12">
                <div class="form-row" style="margin-top:30px; margin-bottom:30px;">
                    <h1><i class="fa fa-cog"></i> Dashboard </h1><small style="margin-top:30px;"> control your website</small>
                </div>
                <hr />
            </div>
            <div class="col-3">
                <div class="well">
                    <div class="list-group">
                        <a class="list-group-item list-group-item-action active " style="background:#ebe9e9; color:#000000; border-color:#ebe9e9;"><span class="fa fa-cog"></span> Dashboard</a>
                        <a class="list-group-item list-group-item-action" href="#"><span class="fa fa-user"></span> Regestered users <span class="badge badge-secondary" id="nUsr"></span></a>
                        <a class="list-group-item list-group-item-action" href="#"><span class="fa fa-archive"></span> Current packages <span class="badge badge-secondary" id="nPkg"></span></a>
                        <a class="list-group-item list-group-item-action" href="#"><span class="fa fa-wrench"></span> Current services <span class="badge badge-secondary" id="nSrvs"></span></a>
                    </div>
                </div>
            </div>
            <div class="col-9">
                <div class="card">
                    <div class="card-header" style="background:#ebe9e9;border-color:#ebe9e9;">
                        Packages Overview
                    </div>
                    <div class="card-body">
                        <div class="row" id="msg">
                            <button class="btn btn-outline-secondary ml-5" data-toggle="modal" data-target="#addpackage" id="addPkg">Create New</button>
                        </div>
                        <hr />
                        <!--package-cards-start-->
                        <div id="dspPkg">

                        </div>
                        <!--end-->
                        <!--end-package-->
                    </div>
                </div>
            </div>
        </div>
        <!--modal-start-->
        <div class="modal fade" id="editpackage" tabindex="-1" role="dialog" aria-describedby="#editpackagetitle" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header" id="editpackagetitle">
                        <h5 class="modal-title">Edit packages</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form>
                            <div class="form-group">
                                <label for="title">Package title</label>
                                <input class="form-control" type="text" id="EDITtitle" placeholder="Please enter package title " />
                            </div>
                            <div class="form-group">
                                <label for="description">Description</label>
                                <textarea class="form-control" id="EDITdescription" rows="8" style="resize:none;" placeholder="Please enter description here"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="title">Upload Image</label>
                                <input class="form-control" accept="image/jpg,image/jpeg,image/png" type="file" id="EDITimage" placeholder=" " />
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" id="editPkgBtn">Save changes</button>
                    </div>
                </div>
            </div>
        </div>
        <!--modal-end-->
        <!--add-modal-start-->
        <div class="modal fade" id="addpackage" tabindex="-1" role="dialog" aria-describedby="#addpackagetitle" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header" id="addpackagetitle">
                        <h5 class="modal-title">Add package</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form>
                            <div class="form-group">
                                <label for="title">Package title</label>
                                <input class="form-control" type="text" id="ADDtitle" placeholder="Please enter package title " />
                            </div>
                            <div class="form-group">
                                <label for="description">Description</label>
                                <textarea class="form-control" id="ADDdescription" rows="8" style="resize:none;" placeholder="Please enter description here"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="title">Upload Image</label>
                                <input class="form-control" accept="image/jpg,image/jpeg,image/png" type="file" id="ADDimage" placeholder=" " />
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" id="addPkgBtn">Create package</button>
                    </div>
                </div>
            </div>
        </div>
        <!--Add-modal-end-->

    </div>
    <!--footer-->
    <footer>
        <div class="card-footer custom-footer">Copyright by &copy; Danish Ali,2019</div>
    </footer>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script>window.jQuery || document.write('<script src="/docs/4.3/assets/js/vendor/jquery-slim.min.js"><\/script>')</script>
    <script src="bootstrap/js/bootstrap.bundle.min.js" integrity="sha384-xrRywqdh3PHs8keKZN+8zzc5TX0GRTLCcmivcbNJWm2rs5C8PRhcEn3czEjhAO9o" crossorigin="anonymous"></script>
    <!--for calling web api-->
    <script>
        $(document).ready(function () {
            //calling get to load packages to page
            var xhr = new XMLHttpRequest();
            xhr.open('GET', 'http://localhost:54844/api/Packages', 'true');
            xhr.onload = function ()
            {
                //console.log(this.responseText);
                if (this.status == "200" && this.responseText != "[]") {
                    var data = JSON.parse(this.responseText);
                    
                    for (var x in data) {
                        $("#dspPkg").append( `<div class="row">
                            <div class="col-6">
                                <div class="card mb-3" style="max-width: 540px;">
                                    <div class="row no-gutters">
                                        <div class="col-md-4">
                                            <img src="${data[x].ImagePath}" class="card-img" id="pkgImg" alt="...">
                                        </div>
                                        <div class="col-md-8">
                                            <div class="card-body">
                                                <h5 class="card-title" id="pkgTitle">${data[x].Title}</h5>
                                                <p class="card-text" id="pkgDesc">${data[x].Description}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6" style="padding-top:15%">
                                <button class="btn btn-outline-primary" data-toggle="modal" data-target="#editpackage" onclick="editPkg(${data[x].Id})"> <i class="fa fa-pen"></i> </button>
                                <button class="btn btn-outline-danger" onclick="deletePkg(${data[x].Id})" > <i class="fa fa-trash-alt"></i> </button>
                            </div>
                        </div>`);
                    }
                } else
                {
                    alert("no packages found!!");
                }
            }
            xhr.send();
            //badge no get
            var xhr1 = new XMLHttpRequest();
            xhr1.open('GET', 'http://localhost:54844/api/Users', 'true');
            xhr1.onload = function () {
                if (this.status == "200") {
                    var data = JSON.parse(this.responseText);
                    var x;
                    var countUsr = 0;
                    for (x in data) { ++countUsr; }
                    $("#nUsr").text(countUsr);
                }
            }
            xhr1.send();
            ////chk no of packages
            var xhr1 = new XMLHttpRequest();
            xhr1.open('GET', 'http://localhost:54844/api/Packages', 'true');
            xhr1.onload = function () {
                if (this.status == "200") {
                    var data = JSON.parse(this.responseText);
                    var x;
                    var countPkg = 0;
                    for (x in data) { ++countPkg; }
                    $("#nPkg").text(countPkg);
                }
            }
            xhr1.send();
            ////chk no of services
            var xhr2 = new XMLHttpRequest();
            xhr2.open('GET', 'http://localhost:54844/api/Services', 'true');
            xhr2.onload = function () {
                if (this.status == "200") {
                    var data = JSON.parse(this.responseText);
                    var x;
                    var countSrv = 0;
                    for (x in data) { ++countSrv; }
                    $("#nSrvs").text(countSrv);
                }
            }
            xhr2.send();
        });
        //Add Package
        $("#addPkgBtn").click(function () {
            var pTitle, pDesc, pImg;
            pTitle = $("#ADDtitle").val();
            pDesc = $("#ADDdescription").val();
            pImg = $("#ADDimage").val();
            console.log("title : " + pTitle + "\t desc : " + pDesc + "\t image : " + pImg);
            var pkg = 'Title=' + pTitle + '&Description=' + pDesc + '&ImagePath=' + pImg;
            var xhr = new XMLHttpRequest();
            xhr.open('POST', 'http://localhost:54844/api/Packages', 'true');
            xhr.onload = function ()
            {
                if (this.status == "201") {
                    console.log("inserted!!");
                    var htm = "<div class='alert alert-info'>Record added!</div>";
                    $("#msg").html(htm);
                    location.reload(true);
                } else
                {
                    console.log("Error : " + this.status);
                }
            }
            xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
            xhr.send(pkg);
        });
        //Update/edit package
        var ID;
        function editPkg(id)
        {
            ID = id;
            var xhr = new XMLHttpRequest();
            xhr.open('GET', 'http://localhost:54844/api/Packages/'+ID, 'true');
            xhr.onload = function ()
            {
                var data = JSON.parse(this.responseText);
                if (this.status == "200") {
                    $("#EDITtitle").val(data.Title);
                    $("#EDITdescription").val(data.Description);
                    $("#EDITimage").val(data.ImagePath);
                } else
                {
                    console.log(this.status);
                }
            }
            xhr.send();
        }
        $("#editPkgBtn").click(function () {
            var pTitle, pDesc, pImg;
            pTitle = $("#EDITtitle").val();
            pDesc = $("#EDITdescription").val();
            pImg = $("#EDITimage").val();
            console.log("title : " + pTitle + "\t desc : " + pDesc + "\t image : " + pImg);
            var pkg = 'Id='+ID+'&Title=' + pTitle + '&Description=' + pDesc + '&ImagePath=' + pImg;
            var xhr = new XMLHttpRequest();
            xhr.open('PUT', 'http://localhost:54844/api/Packages/'+ID, 'true');
            xhr.onload = function () {
                if (this.status == "204") {
                    console.log("updated");
                    location.reload(true);
                    var htm = "<div class='alert alert-info'>Record updated!</div>";
                    $("#msg").html(htm);
                } else {
                    console.log("Error : " + this.status);
                }
            }
            xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
            xhr.send(pkg);
        });
        //Delete package
        function deletePkg(id) {
            ID = id;
            var xhr = new XMLHttpRequest();
            xhr.open('DELETE', 'http://localhost:54844/api/Packages/' + ID, 'true');
            xhr.onload = function () {
                if (this.status == "200") {
                    console.log("Deleted!");
                    location.reload(true);
                    var htm = "<div class='alert alert-info'>Record deleted!</div>";
                    $("#msg").html(htm);
                } else {
                    console.log("Error : " + this.status);
                    location.reload(true);
                    var htm = "<div class='alert alert-info'>Record deleted!</div>";
                    $("#msg").html(htm);
                }
            }
            xhr.send(null);
        }
    </script>
</body>
</html>